<Window x:Class="DeltaForceTracker.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
        xmlns:controls="clr-namespace:DeltaForceTracker.Controls"
        Title="{DynamicResource Lang.Title}"
        Height="820"
        Width="1080"
        Background="Transparent"
        WindowStartupLocation="CenterScreen"
        FontFamily="{StaticResource MainFont}">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="40" GlassFrameThickness="0" ResizeBorderThickness="4"/>
    </WindowChrome.WindowChrome>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Title Bar -->
            <RowDefinition Height="*"/>    <!-- Content -->
        </Grid.RowDefinitions>

        <!-- Animated Background Layer -->
        <controls:AnimatedBackground Grid.RowSpan="2"/>
        
        <!-- Custom Title Bar -->
        <Border Grid.Row="0" Background="{StaticResource MediumBackgroundBrush}" Padding="15,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Title with Tactical Accent -->
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <Border Width="3" Height="20" Background="{StaticResource AccentBrush}" Margin="0,0,10,0" CornerRadius="1.5"/>
                    <TextBlock Text="DELTA FORCE" FontWeight="Bold" Foreground="{StaticResource AccentBrush}" FontSize="16" Margin="0,0,5,0"/>
                    <TextBlock Text="TRACKER" FontWeight="Light" Foreground="{StaticResource TextPrimaryBrush}" FontSize="16"/>
                </StackPanel>

                <!-- Language Switcher & Window Controls -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" WindowChrome.IsHitTestVisibleInChrome="True">
                    <!-- Language Toggle Button -->
                    <Button x:Name="LanguageToggleButton" 
                            Content="EN"
                            Width="50" 
                            Height="30"
                            Margin="0,0,15,0"
                            Style="{StaticResource ModernButton}"
                            FontSize="11"
                            Click="LanguageToggleButton_Click"/>
                    
                    <!-- Window Control Buttons -->
                    <Button x:Name="MinimizeButton"
                            Content="—"
                            Style="{StaticResource ModernButton}"
                            Width="40"
                            Height="30"
                            FontSize="16"
                            Margin="5,0,0,0"
                            Click="MinimizeButton_Click"
                            ToolTip="Minimize"/>
                    
                    <Button x:Name="MaximizeButton"
                            Content="□"
                            Style="{StaticResource ModernButton}"
                            Width="40"
                            Height="30"
                            FontSize="16"
                            Margin="5,0,0,0"
                            Click="MaximizeButton_Click"
                            ToolTip="Maximize"/>
                    
                    <Button x:Name="CloseButton"
                            Content="✕"
                            Style="{StaticResource ModernButton}"
                            Width="40"
                            Height="30"
                            FontSize="16"
                            Margin="5,0,0,0"
                            Click="CloseButton_Click"
                            ToolTip="Close"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <TabControl Grid.Row="1" Margin="20">
            <TabItem Header="{DynamicResource Lang.Dashboard}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" PanningMode="VerticalOnly">
                    <StackPanel Margin="0,10,0,0">
                        <!-- Top Stats Row -->
                        <Grid Margin="0,0,0,20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="1.5*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Current Balance (Big Card) -->
                            <Border x:Name="BalanceCard" Style="{StaticResource Card}" Grid.Column="0" Margin="0,0,10,0">
                                <StackPanel>
                                    <TextBlock Text="{DynamicResource Lang.CurrentBalance}" Style="{StaticResource LabelText}"/>
                                    <TextBlock x:Name="CurrentBalanceText" Text="0.00M" Style="{StaticResource ValueText}" Foreground="{StaticResource AccentBrush}"/>
                                    <TextBlock x:Name="LastScanText" Text="{DynamicResource Lang.Status.NoScans}" Style="{StaticResource LabelText}" Margin="0,5,0,0" Opacity="0.7"/>
                                </StackPanel>
                            </Border>

                            <!-- Daily P&L -->
                            <Border x:Name="PLCard" Style="{StaticResource Card}" Grid.Column="1" Margin="10,0,0,0">
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="{DynamicResource Lang.DailyPL}" Style="{StaticResource LabelText}"/>
                                    <TextBlock x:Name="DailyPLText" Text="+0.00M" FontSize="42" FontWeight="Bold" Foreground="{StaticResource SuccessBrush}"/>
                                </StackPanel>
                            </Border>
                        </Grid>

                        <!-- Status & Actions Row -->
                        <Grid Margin="0,10,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Actions Card (LEFT) -->
                            <Border x:Name="ActionsCard" Style="{StaticResource Card}" Grid.Column="0" Margin="0,0,10,0" Padding="15">
                                <StackPanel>
                                    <TextBlock Text="{DynamicResource Lang.Actions}" 
                                               Style="{StaticResource LabelText}" 
                                               Margin="0,0,0,15"/>
                                    
                                    <Button x:Name="ScanButton" 
                                            Content="{DynamicResource Lang.ScanNow}" 
                                            Style="{StaticResource ModernButton}" 
                                            Margin="0,0,0,10" 
                                            Click="ScanButton_Click"/>
                                    
                                    <Button x:Name="SelectRegionButton" 
                                            Content="{DynamicResource Lang.SelectRegion}" 
                                            Style="{StaticResource ModernButton}" 
                                            Margin="0,0,0,10" 
                                            Click="SelectRegionButton_Click"/>
                                    
                                    <Button x:Name="ResetDataButton" 
                                            Content="{DynamicResource Lang.ResetAnalytics}" 
                                            Style="{StaticResource DangerButton}" 
                                            Margin="0,0,0,15" 
                                            Click="ResetDataButton_Click"/>
                                    
                                    <Separator Margin="0,0,0,10" Background="{StaticResource BorderBrush}"/>
                                    
                                    <!-- Hotkey Info -->
                                    <TextBlock Text="{DynamicResource Lang.Hotkey}" 
                                               Style="{StaticResource LabelText}" 
                                               FontSize="11"
                                               Margin="0,0,0,5"/>
                                    <TextBlock Text="F8" 
                                               FontFamily="{StaticResource MainFont}"
                                               FontSize="16"
                                               FontWeight="Bold"
                                               Foreground="{StaticResource AccentBrush}"
                                               Margin="0,0,0,10"/>
                                    
                                    <CheckBox x:Name="FloatingButtonToggle"
                                              Content="{DynamicResource Lang.FloatingButton}"
                                              FontFamily="{StaticResource MainFont}"
                                              FontSize="12"
                                              Foreground="{StaticResource TextSecondaryBrush}"
                                              Cursor="Hand"
                                              Margin="0,0,0,0"
                                              Checked="FloatingButtonToggle_Checked"
                                              Unchecked="FloatingButtonToggle_Unchecked"/>
                                </StackPanel>
                            </Border>

                            <!-- Status (RIGHT) -->
                            <Border x:Name="StatusCard" Style="{StaticResource Card}" Grid.Column="1" Margin="10,0,0,0">
                                <StackPanel>
                                    <TextBlock Text="{DynamicResource Lang.Status}" Style="{StaticResource LabelText}"/>
                                    <TextBlock x:Name="StatusText" Text="{DynamicResource Lang.Status.Ready}" Foreground="{StaticResource TextPrimaryBrush}" FontSize="18" TextWrapping="Wrap"/>
                                </StackPanel>
                            </Border>
                        </Grid>

                        <!-- Quote of the Day Card -->
                        <Border x:Name="QuoteCard" Style="{StaticResource Card}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- Header with Refresh Button -->
                                <Grid Grid.Row="0" Margin="0,0,0,15">
                                    <TextBlock Text="{DynamicResource Lang.QuoteOfTheDay}" 
                                             Style="{StaticResource LabelText}"
                                             VerticalAlignment="Center"/>
                                    <Button x:Name="RefreshQuoteButton"
                                          Content="↻"
                                          Style="{StaticResource ModernButton}"
                                          FontSize="20"
                                          Padding="8,4"
                                          HorizontalAlignment="Right"
                                          Click="RefreshQuoteButton_Click"
                                          ToolTip="{DynamicResource Lang.RefreshQuote}"/>
                                </Grid>

                                <!-- Quote Text -->
                                <TextBlock x:Name="QuoteText"
                                         Grid.Row="1"
                                         Text="Сегодня — хороший день чтобы win!"
                                         FontSize="18"
                                         FontWeight="Medium"
                                         FontStyle="Italic"
                                         Foreground="{StaticResource AccentBrush}"
                                         TextWrapping="Wrap"
                                         LineHeight="26"
                                         HorizontalAlignment="Center"
                                         TextAlignment="Center"/>
                            </Grid>
                        </Border>

                        <!-- "I'm Tilted" Button - Bottom Center -->
                        <Border HorizontalAlignment="Center" Margin="0,30,0,0">
                            <Button x:Name="TiltButton"
                                    Content="{DynamicResource Lang.TiltButton}"
                                    Style="{StaticResource TiltButton}"
                                    Width="250"
                                    Height="60"
                                    Click="TiltButton_Click"/>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="{DynamicResource Lang.Analytics}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="0,10,0,0">
                        <!-- Chart -->
                        <Border Style="{StaticResource Card}" Height="350">
                            <StackPanel>
                                <TextBlock Text="{DynamicResource Lang.BalanceHistory}" Style="{StaticResource LabelText}"/>
                                <lvc:CartesianChart x:Name="BalanceChart" Height="280" Margin="0,10,0,0"/>
                            </StackPanel>
                        </Border>

                        <!-- Stats Grid -->
                        <Grid Margin="0,0,0,20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/> <!-- NEW: For Tilt Counter -->
                            </Grid.ColumnDefinitions>

                            <Border Style="{StaticResource Card}" Grid.Column="0" Margin="0,0,10,0" Padding="15">
                                <StackPanel>
                                    <TextBlock Text="{DynamicResource Lang.BestDay}" Style="{StaticResource LabelText}" FontSize="11"/>
                                    <TextBlock x:Name="BestDayText" Text="+0.00M" Foreground="{StaticResource SuccessBrush}" FontSize="20" FontWeight="Bold"/>
                                </StackPanel>
                            </Border>

                            <Border Style="{StaticResource Card}" Grid.Column="1" Margin="5,0,5,0" Padding="15">
                                <StackPanel>
                                    <TextBlock Text="{DynamicResource Lang.WorstDay}" Style="{StaticResource LabelText}" FontSize="11"/>
                                    <TextBlock x:Name="WorstDayText" Text="-0.00M" Foreground="{StaticResource ErrorBrush}" FontSize="20" FontWeight="Bold"/>
                                </StackPanel>
                            </Border>

                            <Border Style="{StaticResource Card}" Grid.Column="2" Margin="5,0,5,0" Padding="15">
                                <StackPanel>
                                    <TextBlock Text="{DynamicResource Lang.HighestBalance}" Style="{StaticResource LabelText}" FontSize="11"/>
                                    <TextBlock x:Name="HighestBalanceText" Text="0.00M" Foreground="{StaticResource TextPrimaryBrush}" FontSize="20" FontWeight="Bold"/>
                                </StackPanel>
                            </Border>

                            <Border Style="{StaticResource Card}" Grid.Column="3" Margin="10,0,0,0" Padding="15">
                                <StackPanel>
                                    <TextBlock Text="{DynamicResource Lang.TotalScans}" Style="{StaticResource LabelText}" FontSize="11"/>
                                    <TextBlock x:Name="TotalScansText" Text="0" Foreground="{StaticResource TextPrimaryBrush}" FontSize="20" FontWeight="Bold"/>
                                </StackPanel>
                            </Border>

                            <!-- Tilt Counter Card -->
                            <Border Style="{StaticResource Card}" Grid.Column="4" Margin="10,0,0,0" Padding="15">
                                <StackPanel>
                                    <TextBlock Text="{DynamicResource Lang.Analytics.Tilts}" 
                                               Style="{StaticResource LabelText}" 
                                               FontSize="11"/>
                                    <TextBlock x:Name="TotalTiltsText" 
                                               Text="0" 
                                               Foreground="#FF1744" 
                                               FontSize="28" 
                                               FontWeight="Bold"/>
                                    <TextBlock Text="{DynamicResource Lang.Analytics.TodayTilts}" 
                                               Style="{StaticResource LabelText}" 
                                               FontSize="10" 
                                               Margin="0,5,0,2"/>
                                    <TextBlock x:Name="TodayTiltsText" 
                                               Text="0" 
                                               Foreground="#DC143C" 
                                               FontSize="16" 
                                               FontWeight="Bold"/>
                                </StackPanel>
                            </Border>
                        </Grid>

                        <!-- History Table -->
                        <Border Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="{DynamicResource Lang.ScanHistory}" Style="{StaticResource LabelText}"/>
                                <DataGrid x:Name="HistoryDataGrid" MaxHeight="400" Margin="0,10,0,0">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="{DynamicResource Lang.Time}" Binding="{Binding Timestamp, StringFormat='yyyy-MM-dd HH:mm:ss'}" Width="*"/>
                                        <DataGridTextColumn Header="{DynamicResource Lang.RawValue}" Binding="{Binding RawValue}" Width="*"/>
                                        
                                        <!-- Delta Column -->
                                        <DataGridTemplateColumn Header="{DynamicResource Lang.Delta}" Width="*">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                        <TextBlock Text="{Binding DeltaIndicator}" 
                                                                   Foreground="{Binding DeltaColor}"
                                                                   FontSize="12"
                                                                   FontWeight="Bold"
                                                                   Margin="0,0,5,0"/>
                                                        <TextBlock Text="{Binding DeltaText}" 
                                                                   Foreground="{Binding DeltaColor}"
                                                                   FontWeight="Bold"
                                                                   FontFamily="{StaticResource MonoFont}"/>
                                                    </StackPanel>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        
                                        <DataGridTextColumn Header="{DynamicResource Lang.NumericValue}" Binding="{Binding NumericValue, StringFormat='N2'}" Width="*"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <!-- Version Label - Bottom Right -->
        <TextBlock Grid.Row="1" 
                   x:Name="VersionLabel"
                   Text="v1.8.2"
                   FontSize="9"
                   Foreground="{StaticResource TextSecondaryBrush}"
                   Opacity="0.5"
                   HorizontalAlignment="Right"
                   VerticalAlignment="Bottom"
                   Margin="0,0,15,8"/>
    </Grid>
</Window>
